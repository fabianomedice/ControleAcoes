<!DOCTYPE html> 

<html lang="pt-br" style="scroll-behavior: smooth;">
	<head>
		<!-- Titulo da aba-->
		<title> 
			Controle de Ações de Vanderlei
		</title>
		<!-- Metadados -->
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="author" content="Fabiano Médice">
        <link rel="stylesheet" type="text/css" href="CSS/style.css">
	</head>
	<body>
        <header>
            <nav class="menu">
                <div class="menu-dropdown PaginaAtiva">
                    <button class="botao-dropdown">Consultas</button>
                    <div class="conteudo-dropdown">
                        <a href="resumo.html">Carteira de Ações Atuais</a>
                        <a href="controlelucroprejuizo.html">Controle de Lucro e Prejuízo</a>
                        <a href="historico.html">Histórico de Notas Fiscais</a>
                        <a href="imposto.html">Imposto Devido Mensal</a>
                    </div>
                </div>    
                <div class="menu-dropdown">
                    <button class="botao-dropdown">Cadastros</button>
                    <div class="conteudo-dropdown">
                        <a href="compra.html">Compra de Ações</a>
                        <a href="venda.html">Venda de Ações</a>
                        <a href="notafiscal.html">Nota Fiscal</a>
                    </div>
                </div>    
                <div class="menu-dropdown">
                    <button class="botao-dropdown">Modificações</button>
                    <div class="conteudo-dropdown">
                        <a href="mudancavenda.html">Modificar Venda</a>
                        <a href="cancelarcadastro.html">Cancelar Cadastro</a>
                    </div>
                </div>
                <div class="menu-dropdown" >
                    <button class="botao-dropdown" onclick="window.location.href='index.html';">Sobre</button>
                </div>
            </nav>
            <h1 id="titulo">Controle de Lucro e Prejuízo das Vendas à Vista</h1>     
        </header>
        
        <section >
            <h2>Histórico dos últimos 60 dias</h2>
            <div style="grid-template-rows: 1fr; display: grid;">
                <div style="grid-template-columns: repeat(10,1fr); display: grid; text-align: center;">
                    <div>
                        <b>Data Venda</b>
                    </div>
                    <div>
                        <b>Ações</b>
                    </div>
                    <div>
                        <b>Corretora</b>
                    </div>
                    <div>
                        <b>Quantidade</b>
                    </div>
                    <div>
                        <b>NF Venda</b>
                    </div>
                    <div>
                        <b>Valor Venda</b>
                    </div>
                    <div>
                        <b>Data Compra</b>
                    </div>
                    <div>
                        <b>NF Compra</b>
                    </div>
                    <div>
                        <b>Valor Compra</b>
                    </div>
                    <div>
                        <b>Lucro</b>
                    </div>
                </div>
            </div>
            <div id="Controle"></div>
                    
            <br><br>
                
        </section>
        <footer>
            <b>Feito por Fabiano Médice<br>2020</b>
        </footer>
        <script>

            //Cria a data
            var Ano = new Date().getFullYear();
            var Mes = new Date().getMonth()+1;
            var Dia = new Date().getDate();
            var DataFinal;
            if (Dia<10)
            {
                //coloca o zero
                DataFinal = Ano+"-"+Mes+"-0"+Dia;
            }
            else
            {
                //salva a data normal
                DataFinal = Ano+"-"+Mes+"-"+Dia;
            }
            //Faz a data final
            var DataInicial = new Date();
            DataInicial.setDate(DataInicial.getDate() - 60);
            Ano=DataInicial.getFullYear();
            Mes = DataInicial.getMonth()+1;
            Dia = DataInicial.getDate();
            if (Dia<10)
            {
                //coloca o zero
                DataInicial = Ano+"-"+Mes+"-0"+Dia;
            }
            else
            {
                //salva a data normal
                DataInicial = Ano+"-"+Mes+"-"+Dia;
            }

            //Iniciação
            Chamar_Banco_De_Dados_Acoes();

            // -------------------------------------------------------
            //Função para ler o banco de dados de compras
            // -------------------------------------------------------
            function Chamar_Banco_De_Dados_Acoes()
            {
                // Chama a leitura para o servidor
                var xhttp;
                xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function() 
                {
                    if (this.readyState == 4 && this.status == 200) 
                    {
                        if(this.responseText == "Nenhuma Ação Encontrada")
                        {
                            document.getElementById("VendasCadastradas").innerHTML = this.responseText;
                        }
                        else
                        {
                            $BancoDeDados_Acoes = JSON.parse(this.responseText);
                            Ler_NF();
                            //console.log($BancoDeDados_Acoes)
                            //document.getElementById("VendasCadastradas").innerHTML = this.responseText;
                        }
                    }
                }
                xhttp.open("POST", "PHP/LucroPrejuizo.php", false); //o false não deixa ser assincrono
                xhttp.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                xhttp.send("DataInicial="+DataInicial+"&DataFinal="+DataFinal);
            }

            // -------------------------------------------------------
            //Função para ler o banco de dados de Notas Fiscais
            // -------------------------------------------------------
            function Ler_NF()
            {
                // Chama a leitura para o servidor
                var xhttp;
                xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function() 
                {
                    if (this.readyState == 4 && this.status == 200) 
                    {
                        if(this.responseText == "Nenhuma Nota Fiscal Encontrada")
                        {
                            $BancoDeDados_NF = this.responseText;
                        }
                        else
                        {
                            $BancoDeDados_NF = JSON.parse(this.responseText);
                        }
                        OrganizaBancoDeDados();
                    }
                }
                xhttp.open("GET", "PHP/LerNF.php", false); //o false não deixa ser assincrono
                xhttp.send();
            }
            // -------------------------------------------------------
            // Organiza o Banco de Dados Enviados e cria divs
            // -------------------------------------------------------
            function OrganizaBancoDeDados()
            {
                //organiza o banco de dados
                multiSort($BancoDeDados_Acoes, {Operacao: 'asc', Data: 'asc', NomeAcao: 'asc', CorretoraAcao: 'asc',  CodigoAcao: 'asc'})
                
                var texto="";

                var NumeroLinha = 1;
                var QuantidadeTotal = 0;
                var ValorVentaTotal = 0;
                var ValorCompraTotal = 0;
                var ValorLucroTotal = 0;
                var NomeAcaoNaoDayTrade = '';
                var DataAcaoNaoDayTrade = '';
                var CorretoraAcaoNaoDayTrade = '';
                for (i=0;i<$BancoDeDados_Acoes.length;i++)
                {
                    if($BancoDeDados_Acoes[i].Operacao == "Venda")
                    {
                        //Só pega as vendas
                        var QuantidadeNF = $BancoDeDados_NF.length; //teste para conferencia de Nota Fiscal
                        //Calculo do preço líquido
                        for(j=0;j<$BancoDeDados_NF.length;j++)
                        {
                            if($BancoDeDados_Acoes[i].Data == $BancoDeDados_NF[j].Data && $BancoDeDados_Acoes[i].CorretoraAcao == $BancoDeDados_NF[j].CorretoraNF && $BancoDeDados_Acoes[i].NotaFiscalAcao == $BancoDeDados_NF[j].NotaFiscal)
                            {
                                var CustoTotalOperacao = $BancoDeDados_NF[j].CustoTotalOperacao;
                                var ValorOperacoesTotais = $BancoDeDados_NF[j].ValorOperacoesTotais;
                            }
                            else
                            {
                                //Não achou a Nota Fiscal
                                QuantidadeNF = QuantidadeNF-1;
                                if(QuantidadeNF==0)
                                {
                                    //não achou a Nota Fiscal
                                    var CustoTotalOperacao = 0;
                                    var ValorOperacoesTotais = 0;
                                }
                            }
                        }
                        //Preço liquido da venda = Subtrai o custo da operação
                        PrecoLiquidoTotal_Venda = ($BancoDeDados_Acoes[i].Custo*$BancoDeDados_Acoes[i].QuantidadeTotal-$BancoDeDados_Acoes[i].QuantidadeTotal*$BancoDeDados_Acoes[i].Custo/ValorOperacoesTotais*CustoTotalOperacao).toFixed(2);
                        //console.log($BancoDeDados_Acoes[i].Custo)
                        //console.log($BancoDeDados_Acoes[i].QuantidadeRestante)
                        //console.log($BancoDeDados_Acoes[i].QuantidadeTotal)

                        //Confere se não é DayTrade
                        EhDaytrade = false;
                        for(j=0;j<$BancoDeDados_Acoes.length;j++)
                        {
                            if
                            (
                                $BancoDeDados_Acoes[j].Operacao=="DayTrade" && //Confere se a operação a ser comparada é Dray trade
                                $BancoDeDados_Acoes[i].NomeAcao == $BancoDeDados_Acoes[j].NomeAcao && //Confere se os nomes são os mesmos
                                $BancoDeDados_Acoes[i].CodigoAcao == $BancoDeDados_Acoes[j].CodigoAcao && //Confere se os codigos são os mesmos
                                $BancoDeDados_Acoes[i].CorretoraAcao == $BancoDeDados_Acoes[j].CorretoraAcao && //Confere se a corretora é a mesma
                                $BancoDeDados_Acoes[i].Data == $BancoDeDados_Acoes[j].Data && //Confere se as datas são as mesmas
                                $BancoDeDados_Acoes[i].NotaFiscalAcao == $BancoDeDados_Acoes[j].NotaFiscalAcao //Confere se as notas fiscais são as mesmas
                            )
                            {
                                //console.log("É daytrade - "+$BancoDeDados_Acoes[i].NomeAcao+" - "+$BancoDeDados_Acoes[i].CodigoAcao)
                                EhDaytrade = true;
                            }
                            
                            //Procura a compra desta ação de venda
                            if
                            (
                                $BancoDeDados_Acoes[j].Operacao == "Compra" && //confere se a operação a ser comparada é Compra
                                $BancoDeDados_Acoes[i].NomeAcao == $BancoDeDados_Acoes[j].NomeAcao && //Confere se os nomes são os mesmos
                                $BancoDeDados_Acoes[i].CodigoAcao == $BancoDeDados_Acoes[j].CodigoAcao && //Confere se os codigos são os mesmos
                                $BancoDeDados_Acoes[i].CorretoraAcao == $BancoDeDados_Acoes[j].CorretoraAcao //Confere se a corretora é a mesma
                            )
                            {
                                var QuantidadeNF = $BancoDeDados_NF.length; //teste para conferencia de Nota Fiscal
                                //Calculo do preço líquido
                                for(k=0;k<$BancoDeDados_NF.length;k++)
                                {
                                    if($BancoDeDados_Acoes[j].Data == $BancoDeDados_NF[k].Data && $BancoDeDados_Acoes[j].CorretoraAcao == $BancoDeDados_NF[k].CorretoraNF && $BancoDeDados_Acoes[j].NotaFiscalAcao == $BancoDeDados_NF[k].NotaFiscal)
                                    {
                                        var CustoTotalOperacao = $BancoDeDados_NF[k].CustoTotalOperacao;
                                        var ValorOperacoesTotais = $BancoDeDados_NF[k].ValorOperacoesTotais;
                                    }
                                    else
                                    {
                                        //Não achou a Nota Fiscal
                                        QuantidadeNF = QuantidadeNF-1;
                                        if(QuantidadeNF==0)
                                        {
                                            //não achou a Nota Fiscal
                                            var CustoTotalOperacao = 0;
                                            var ValorOperacoesTotais = 0;
                                        }
                                    }
                                }
                                //Preço liquido da compra = Soma o custo da operação
                                PrecoLiquidoTotal_Compra = (($BancoDeDados_Acoes[j].Custo*$BancoDeDados_Acoes[j].QuantidadeTotal+$BancoDeDados_Acoes[j].QuantidadeTotal*$BancoDeDados_Acoes[j].Custo/ValorOperacoesTotais*CustoTotalOperacao)/$BancoDeDados_Acoes[j].QuantidadeTotal*$BancoDeDados_Acoes[i].QuantidadeTotal).toFixed(2);

                                //Pega os dados da compra
                                var DataCompra = $BancoDeDados_Acoes[j].Data;
                                var NotaFiscalCompra = $BancoDeDados_Acoes[j].NotaFiscalAcao;
                            }
                        }

                        if(!EhDaytrade)
                        {
                            //não é day trade
                            //atualiza pra ultima ação q não é Day Trade
                            NomeAcaoNaoDayTrade = $BancoDeDados_Acoes[i].NomeAcao;
                            DataAcaoNaoDayTrade = $BancoDeDados_Acoes[i].Data;
                            CorretoraAcaoNaoDayTrade = $BancoDeDados_Acoes[i].CorretoraAcao

                            //console.log("Não é day trade - "+$BancoDeDados_Acoes[i].NomeAcao+" - "+$BancoDeDados_Acoes[i].CodigoAcao)
                            if(i+1<$BancoDeDados_Acoes.length )
                            {
                                if($BancoDeDados_Acoes[i].NomeAcao==$BancoDeDados_Acoes[i+1].NomeAcao && $BancoDeDados_Acoes[i].CorretoraAcao==$BancoDeDados_Acoes[i+1].CorretoraAcao && $BancoDeDados_Acoes[i].Data==$BancoDeDados_Acoes[i+1].Data)
                                {
                                    //São a mesma ação

                                    //Atualiza os valores totais
                                    QuantidadeTotal = QuantidadeTotal+parseInt($BancoDeDados_Acoes[i].QuantidadeTotal);
                                    ValorVentaTotal = ValorVentaTotal+parseInt(PrecoLiquidoTotal_Venda);
                                    ValorCompraTotal = ValorCompraTotal+parseInt(PrecoLiquidoTotal_Compra);
                                    ValorLucroTotal = ValorLucroTotal+(PrecoLiquidoTotal_Venda-PrecoLiquidoTotal_Compra);

                                    if(NumeroLinha%2==1)
                                    {
                                        //Linha impar, sem fundo
                                        texto = texto+
                                        '<div style="grid-template-rows: 1fr; display: grid">'+
                                            '<div style="grid-template-columns: repeat(10,1fr); display: grid; text-align: center;">'+
                                                '<div>'+$BancoDeDados_Acoes[i].Data+'</div>'+
                                                '<div>'+$BancoDeDados_Acoes[i].NomeAcao+" - "+$BancoDeDados_Acoes[i].CodigoAcao+'</div>'+
                                                '<div>'+$BancoDeDados_Acoes[i].CorretoraAcao+'</div>'+
                                                '<div>'+$BancoDeDados_Acoes[i].QuantidadeTotal+'</div>'+
                                                '<div>'+$BancoDeDados_Acoes[i].NotaFiscalAcao+'</div>'+
                                                '<div>'+(PrecoLiquidoTotal_Venda*1).toFixed(2)+'</div>'+
                                                '<div>'+DataCompra+'</div>'+
                                                '<div>'+NotaFiscalCompra+'</div>'+
                                                '<div>'+(PrecoLiquidoTotal_Compra*1).toFixed(2)+'</div>';
                                                if(PrecoLiquidoTotal_Venda-PrecoLiquidoTotal_Compra>=0)
                                                {
                                                    //lucro
                                                    texto = texto+
                                                    '<div style="background-color:lightgreen">'+(PrecoLiquidoTotal_Venda-PrecoLiquidoTotal_Compra).toFixed(2)+'</div>';
                                                }
                                                else
                                                {
                                                    //prejuizo
                                                    texto = texto+
                                                    '<div style="background-color:tomato">'+(PrecoLiquidoTotal_Venda-PrecoLiquidoTotal_Compra).toFixed(2)+'</div>';
                                                }
                                                texto = texto+
                                            '</div>'+
                                        '</div>';
                                    }
                                    else
                                    {
                                        //Linha par, com fundo
                                        texto = texto+
                                        '<div style="grid-template-rows: 1fr; display: grid">'+
                                            '<div style="grid-template-columns: repeat(10,1fr); display: grid; text-align: center; background-color:lightgray">'+
                                                '<div>'+$BancoDeDados_Acoes[i].Data+'</div>'+
                                                '<div>'+$BancoDeDados_Acoes[i].NomeAcao+" - "+$BancoDeDados_Acoes[i].CodigoAcao+'</div>'+
                                                '<div>'+$BancoDeDados_Acoes[i].CorretoraAcao+'</div>'+
                                                '<div>'+$BancoDeDados_Acoes[i].QuantidadeTotal+'</div>'+
                                                '<div>'+$BancoDeDados_Acoes[i].NotaFiscalAcao+'</div>'+
                                                '<div>'+(PrecoLiquidoTotal_Venda*1).toFixed(2)+'</div>'+
                                                '<div>'+DataCompra+'</div>'+
                                                '<div>'+NotaFiscalCompra+'</div>'+
                                                '<div>'+(PrecoLiquidoTotal_Compra*1).toFixed(2)+'</div>';
                                                if(PrecoLiquidoTotal_Venda-PrecoLiquidoTotal_Compra>=0)
                                                {
                                                    //lucro
                                                    texto = texto+
                                                    '<div style="background-color:lightgreen">'+(PrecoLiquidoTotal_Venda-PrecoLiquidoTotal_Compra).toFixed(2)+'</div>';
                                                }
                                                else
                                                {
                                                    //prejuizo
                                                    texto = texto+
                                                    '<div style="background-color:tomato">'+(PrecoLiquidoTotal_Venda-PrecoLiquidoTotal_Compra).toFixed(2)+'</div>';
                                                }
                                                texto = texto+
                                            '</div>'+
                                        '</div>';
                                    }

                                    //Variavel numero linha recebe +1
                                    NumeroLinha = NumeroLinha +1;
                                }
                                else
                                {
                                    //Não são a mesma ação

                                    //Atualiza os valores totais
                                    QuantidadeTotal = QuantidadeTotal+parseInt($BancoDeDados_Acoes[i].QuantidadeTotal);
                                    ValorVentaTotal = ValorVentaTotal+parseInt(PrecoLiquidoTotal_Venda);
                                    ValorCompraTotal = ValorCompraTotal+parseInt(PrecoLiquidoTotal_Compra);
                                    ValorLucroTotal = ValorLucroTotal+(PrecoLiquidoTotal_Venda-PrecoLiquidoTotal_Compra);

                                    if(NumeroLinha%2==1)
                                    {
                                        //Linha impar, sem fundo
                                        texto = texto+
                                        '<div style="grid-template-rows: 1fr; display: grid">'+
                                            '<div style="grid-template-columns: repeat(10,1fr); display: grid; text-align: center;">'+
                                                '<div>'+$BancoDeDados_Acoes[i].Data+'</div>'+
                                                '<div>'+$BancoDeDados_Acoes[i].NomeAcao+" - "+$BancoDeDados_Acoes[i].CodigoAcao+'</div>'+
                                                '<div>'+$BancoDeDados_Acoes[i].CorretoraAcao+'</div>'+
                                                '<div>'+$BancoDeDados_Acoes[i].QuantidadeTotal+'</div>'+
                                                '<div>'+$BancoDeDados_Acoes[i].NotaFiscalAcao+'</div>'+
                                                '<div>'+(PrecoLiquidoTotal_Venda*1).toFixed(2)+'</div>'+
                                                '<div>'+DataCompra+'</div>'+
                                                '<div>'+NotaFiscalCompra+'</div>'+
                                                '<div>'+(PrecoLiquidoTotal_Compra*1).toFixed(2)+'</div>';
                                                if(PrecoLiquidoTotal_Venda-PrecoLiquidoTotal_Compra>=0)
                                                {
                                                    //lucro
                                                    texto = texto+
                                                    '<div style="background-color:lightgreen">'+(PrecoLiquidoTotal_Venda-PrecoLiquidoTotal_Compra).toFixed(2)+'</div>';
                                                }
                                                else
                                                {
                                                    //prejuizo
                                                    texto = texto+
                                                    '<div style="background-color:tomato">'+(PrecoLiquidoTotal_Venda-PrecoLiquidoTotal_Compra).toFixed(2)+'</div>';
                                                }
                                                texto = texto+
                                            '</div>'+
                                        '</div>';
                                    }
                                    else
                                    {
                                        //Linha par, com fundo
                                        texto = texto+
                                        '<div style="grid-template-rows: 1fr; display: grid">'+
                                            '<div style="grid-template-columns: repeat(10,1fr); display: grid; text-align: center; background-color:lightgray">'+
                                                '<div>'+$BancoDeDados_Acoes[i].Data+'</div>'+
                                                '<div>'+$BancoDeDados_Acoes[i].NomeAcao+" - "+$BancoDeDados_Acoes[i].CodigoAcao+'</div>'+
                                                '<div>'+$BancoDeDados_Acoes[i].CorretoraAcao+'</div>'+
                                                '<div>'+$BancoDeDados_Acoes[i].QuantidadeTotal+'</div>'+
                                                '<div>'+$BancoDeDados_Acoes[i].NotaFiscalAcao+'</div>'+
                                                '<div>'+(PrecoLiquidoTotal_Venda*1).toFixed(2)+'</div>'+
                                                '<div>'+DataCompra+'</div>'+
                                                '<div>'+NotaFiscalCompra+'</div>'+
                                                '<div>'+(PrecoLiquidoTotal_Compra*1).toFixed(2)+'</div>';
                                                if(PrecoLiquidoTotal_Venda-PrecoLiquidoTotal_Compra>=0)
                                                {
                                                    //lucro
                                                    texto = texto+
                                                    '<div style="background-color:lightgreen">'+(PrecoLiquidoTotal_Venda-PrecoLiquidoTotal_Compra).toFixed(2)+'</div>';
                                                }
                                                else
                                                {
                                                    //prejuizo
                                                    texto = texto+
                                                    '<div style="background-color:tomato">'+(PrecoLiquidoTotal_Venda-PrecoLiquidoTotal_Compra).toFixed(2)+'</div>';
                                                }
                                                texto = texto+
                                            '</div>'+
                                        '</div>';
                                    }
                                    
                                    //Coloca a linha final
                                    NumeroLinha = NumeroLinha+1;
                                    if(NumeroLinha%2==1)
                                    {
                                        //Linha impar, sem fundo
                                        texto = texto+
                                        '<div style="grid-template-rows: 1fr; display: grid">'+
                                            '<div style="grid-template-columns: repeat(10,1fr); display: grid; text-align: center;">'+
                                                '<div><!-- Div Vazia --></div>'+
                                                '<div>'+$BancoDeDados_Acoes[i].NomeAcao+'</div>'+
                                                '<div>'+$BancoDeDados_Acoes[i].CorretoraAcao+'</div>'+
                                                '<div> Total: '+QuantidadeTotal+'</div>'+
                                                '<div>'+$BancoDeDados_Acoes[i].NotaFiscalAcao+'</div>'+
                                                '<div> Total: '+ValorVentaTotal+'</div>'+
                                                '<div><!-- Div Vazia --></div>'+
                                                '<div><!-- Div Vazia --></div>'+
                                                '<div> Total: '+ValorCompraTotal+'</div>';
                                                if(ValorLucroTotal>=0)
                                                {
                                                    //lucro
                                                    texto = texto+
                                                    '<div style="background-color:lightgreen"> Total: '+(ValorLucroTotal).toFixed(2)+'</div>';
                                                }
                                                else
                                                {
                                                    //prejuizo
                                                    texto = texto+
                                                    '<div style="background-color:tomato"> Total : '+(ValorLucroTotal).toFixed(2)+'</div>';
                                                }
                                                texto = texto+
                                            '</div>'+
                                        '</div>';
                                    }
                                    else
                                    {
                                        //Linha par, com fundo
                                        texto = texto+
                                        '<div style="grid-template-rows: 1fr; display: grid">'+
                                            '<div style="grid-template-columns: repeat(10,1fr); display: grid; text-align: center; background-color:lightgray">'+
                                                '<div><!-- Div Vazia --></div>'+
                                                '<div>'+$BancoDeDados_Acoes[i].NomeAcao+'</div>'+
                                                '<div>'+$BancoDeDados_Acoes[i].CorretoraAcao+'</div>'+
                                                '<div> Total: '+QuantidadeTotal+'</div>'+
                                                '<div>'+$BancoDeDados_Acoes[i].NotaFiscalAcao+'</div>'+
                                                '<div> Total: '+ValorVentaTotal+'</div>'+
                                                '<div><!-- Div Vazia --></div>'+
                                                '<div><!-- Div Vazia --></div>'+
                                                '<div> Total: '+ValorCompraTotal+'</div>';
                                                if(ValorLucroTotal>=0)
                                                {
                                                    //lucro
                                                    texto = texto+
                                                    '<div style="background-color:lightgreen"> Total: '+(ValorLucroTotal).toFixed(2)+'</div>';
                                                }
                                                else
                                                {
                                                    //prejuizo
                                                    texto = texto+
                                                    '<div style="background-color:tomato"> Total : '+(ValorLucroTotal).toFixed(2)+'</div>';
                                                }
                                                texto = texto+
                                            '</div>'+
                                        '</div>';
                                    }

                                    //reseta a variavel numero linha
                                    NumeroLinha = 1;

                                    //adiciona uma linha
                                    texto = texto+'<div style="grid-template-rows: 1fr; display: grid"><br></div>';

                                    //reseta as variaveis totais
                                    QuantidadeTotal = 0;
                                    ValorVentaTotal = 0;
                                    ValorCompraTotal = 0;
                                    ValorLucroTotal = 0;
                                }
                                
                            }
                            else
                            {
                                //é a ultima linha

                                //Atualiza os valores totais
                                QuantidadeTotal = QuantidadeTotal+parseInt($BancoDeDados_Acoes[i].QuantidadeTotal);
                                ValorVentaTotal = ValorVentaTotal+parseInt(PrecoLiquidoTotal_Venda);
                                ValorCompraTotal = ValorCompraTotal+parseInt(PrecoLiquidoTotal_Compra);
                                ValorLucroTotal = ValorLucroTotal+(PrecoLiquidoTotal_Venda-PrecoLiquidoTotal_Compra);

                                if(NumeroLinha%2==1)
                                {
                                    //Linha impar, sem fundo
                                    texto = texto+
                                    '<div style="grid-template-rows: 1fr; display: grid">'+
                                        '<div style="grid-template-columns: repeat(10,1fr); display: grid; text-align: center;">'+
                                            '<div>'+$BancoDeDados_Acoes[i].Data+'</div>'+
                                            '<div>'+$BancoDeDados_Acoes[i].NomeAcao+" - "+$BancoDeDados_Acoes[i].CodigoAcao+'</div>'+
                                            '<div>'+$BancoDeDados_Acoes[i].CorretoraAcao+'</div>'+
                                            '<div>'+$BancoDeDados_Acoes[i].QuantidadeTotal+'</div>'+
                                            '<div>'+$BancoDeDados_Acoes[i].NotaFiscalAcao+'</div>'+
                                            '<div>'+(PrecoLiquidoTotal_Venda*1).toFixed(2)+'</div>'+
                                            '<div>'+DataCompra+'</div>'+
                                            '<div>'+NotaFiscalCompra+'</div>'+
                                            '<div>'+(PrecoLiquidoTotal_Compra*1).toFixed(2)+'</div>';
                                            if(PrecoLiquidoTotal_Venda-PrecoLiquidoTotal_Compra>=0)
                                            {
                                                //lucro
                                                texto = texto+
                                                '<div style="background-color:lightgreen">'+(PrecoLiquidoTotal_Venda-PrecoLiquidoTotal_Compra).toFixed(2)+'</div>';
                                            }
                                            else
                                            {
                                                //prejuizo
                                                texto = texto+
                                                '<div style="background-color:tomato">'+(PrecoLiquidoTotal_Venda-PrecoLiquidoTotal_Compra).toFixed(2)+'</div>';
                                            }
                                            texto = texto+
                                        '</div>'+
                                    '</div>';
                                }
                                else
                                {
                                    //Linha par, com fundo
                                    texto = texto+
                                    '<div style="grid-template-rows: 1fr; display: grid">'+
                                        '<div style="grid-template-columns: repeat(10,1fr); display: grid; text-align: center; background-color:lightgray">'+
                                            '<div>'+$BancoDeDados_Acoes[i].Data+'</div>'+
                                            '<div>'+$BancoDeDados_Acoes[i].NomeAcao+" - "+$BancoDeDados_Acoes[i].CodigoAcao+'</div>'+
                                            '<div>'+$BancoDeDados_Acoes[i].CorretoraAcao+'</div>'+
                                            '<div>'+$BancoDeDados_Acoes[i].QuantidadeTotal+'</div>'+
                                            '<div>'+$BancoDeDados_Acoes[i].NotaFiscalAcao+'</div>'+
                                            '<div>'+(PrecoLiquidoTotal_Venda*1).toFixed(2)+'</div>'+
                                            '<div>'+DataCompra+'</div>'+
                                            '<div>'+NotaFiscalCompra+'</div>'+
                                            '<div>'+(PrecoLiquidoTotal_Compra*1).toFixed(2)+'</div>';
                                            if(PrecoLiquidoTotal_Venda-PrecoLiquidoTotal_Compra>=0)
                                            {
                                                //lucro
                                                texto = texto+
                                                '<div style="background-color:lightgreen">'+(PrecoLiquidoTotal_Venda-PrecoLiquidoTotal_Compra).toFixed(2)+'</div>';
                                            }
                                            else
                                            {
                                                //prejuizo
                                                texto = texto+
                                                '<div style="background-color:tomato">'+(PrecoLiquidoTotal_Venda-PrecoLiquidoTotal_Compra).toFixed(2)+'</div>';
                                            }
                                            texto = texto+
                                        '</div>'+
                                    '</div>';
                                }

                                //Coloca a linha final
                                NumeroLinha = NumeroLinha+1;
                                if(NumeroLinha%2==1)
                                {
                                    //Linha impar, sem fundo
                                    texto = texto+
                                    '<div style="grid-template-rows: 1fr; display: grid">'+
                                        '<div style="grid-template-columns: repeat(10,1fr); display: grid; text-align: center;">'+
                                            '<div><!-- Div Vazia --></div>'+
                                            '<div>'+$BancoDeDados_Acoes[i].NomeAcao+'</div>'+
                                            '<div>'+$BancoDeDados_Acoes[i].CorretoraAcao+'</div>'+
                                            '<div> Total: '+QuantidadeTotal+'</div>'+
                                            '<div>'+$BancoDeDados_Acoes[i].NotaFiscalAcao+'</div>'+
                                            '<div> Total: '+ValorVentaTotal+'</div>'+
                                            '<div><!-- Div Vazia --></div>'+
                                            '<div><!-- Div Vazia --></div>'+
                                            '<div> Total: '+ValorCompraTotal+'</div>';
                                            if(ValorLucroTotal>=0)
                                            {
                                                //lucro
                                                texto = texto+
                                                '<div style="background-color:lightgreen"> Total: '+(ValorLucroTotal).toFixed(2)+'</div>';
                                            }
                                            else
                                            {
                                                //prejuizo
                                                texto = texto+
                                                '<div style="background-color:tomato"> Total : '+(ValorLucroTotal).toFixed(2)+'</div>';
                                            }
                                            texto = texto+
                                        '</div>'+
                                    '</div>';
                                }
                                else
                                {
                                    //Linha par, com fundo
                                    texto = texto+
                                    '<div style="grid-template-rows: 1fr; display: grid">'+
                                        '<div style="grid-template-columns: repeat(10,1fr); display: grid; text-align: center; background-color:lightgray">'+
                                            '<div><!-- Div Vazia --></div>'+
                                            '<div>'+$BancoDeDados_Acoes[i].NomeAcao+'</div>'+
                                            '<div>'+$BancoDeDados_Acoes[i].CorretoraAcao+'</div>'+
                                            '<div> Total: '+QuantidadeTotal+'</div>'+
                                            '<div>'+$BancoDeDados_Acoes[i].NotaFiscalAcao+'</div>'+
                                            '<div> Total: '+ValorVentaTotal+'</div>'+
                                            '<div><!-- Div Vazia --></div>'+
                                            '<div><!-- Div Vazia --></div>'+
                                            '<div> Total: '+ValorCompraTotal+'</div>';
                                            if(ValorLucroTotal>=0)
                                            {
                                                //lucro
                                                texto = texto+
                                                '<div style="background-color:lightgreen"> Total: '+(ValorLucroTotal).toFixed(2)+'</div>';
                                            }
                                            else
                                            {
                                                //prejuizo
                                                texto = texto+
                                                '<div style="background-color:tomato"> Total : '+(ValorLucroTotal).toFixed(2)+'</div>';
                                            }
                                            texto = texto+
                                        '</div>'+
                                    '</div>';
                                }
                            }
                        }
                        else
                        {
                            //é day trade
                            //confere se é o ultimo numero
                            if(i+1<$BancoDeDados_Acoes.length )
                            {
                                // não é o ultimo número
                                if($BancoDeDados_Acoes[i].NomeAcao!=$BancoDeDados_Acoes[i+1].NomeAcao)
                                {
                                    //A proxima não é a mesma ação então coloca o final total
                                    if($BancoDeDados_Acoes[i].NomeAcao==NomeAcaoNaoDayTrade && $BancoDeDados_Acoes[i].Data==DataAcaoNaoDayTrade && $BancoDeDados_Acoes[i].CorretoraAcao==CorretoraAcaoNaoDayTrade)
                                    {
                                        //São a mesma ação da ultima não DayTrade resolvida e na mesma data
                                        //Por ser Day trade não aparece, mas tem que jogar o total final
                                        if(NumeroLinha%2==1)
                                        {
                                            //Linha impar, sem fundo
                                            texto = texto+
                                            '<div style="grid-template-rows: 1fr; display: grid">'+
                                                '<div style="grid-template-columns: repeat(10,1fr); display: grid; text-align: center;">'+
                                                    '<div><!-- Div Vazia --></div>'+
                                                    '<div>'+$BancoDeDados_Acoes[i].NomeAcao+'</div>'+
                                                    '<div>'+$BancoDeDados_Acoes[i].CorretoraAcao+'</div>'+
                                                    '<div> Total: '+QuantidadeTotal+'</div>'+
                                                    '<div>'+$BancoDeDados_Acoes[i].NotaFiscalAcao+'</div>'+
                                                    '<div> Total: '+ValorVentaTotal+'</div>'+
                                                    '<div><!-- Div Vazia --></div>'+
                                                    '<div><!-- Div Vazia --></div>'+
                                                    '<div> Total: '+ValorCompraTotal+'</div>';
                                                    if(ValorLucroTotal>=0)
                                                    {
                                                        //lucro
                                                        texto = texto+
                                                        '<div style="background-color:lightgreen"> Total: '+(ValorLucroTotal).toFixed(2)+'</div>';
                                                    }
                                                    else
                                                    {
                                                        //prejuizo
                                                        texto = texto+
                                                        '<div style="background-color:tomato"> Total : '+(ValorLucroTotal).toFixed(2)+'</div>';
                                                    }
                                                    texto = texto+
                                                '</div>'+
                                            '</div>';
                                        }
                                        else
                                        {
                                            //Linha par, com fundo
                                            texto = texto+
                                            '<div style="grid-template-rows: 1fr; display: grid">'+
                                                '<div style="grid-template-columns: repeat(10,1fr); display: grid; text-align: center; background-color:lightgray">'+
                                                    '<div><!-- Div Vazia --></div>'+
                                                    '<div>'+$BancoDeDados_Acoes[i].NomeAcao+'</div>'+
                                                    '<div>'+$BancoDeDados_Acoes[i].CorretoraAcao+'</div>'+
                                                    '<div> Total: '+QuantidadeTotal+'</div>'+
                                                    '<div>'+$BancoDeDados_Acoes[i].NotaFiscalAcao+'</div>'+
                                                    '<div> Total: '+ValorVentaTotal+'</div>'+
                                                    '<div><!-- Div Vazia --></div>'+
                                                    '<div><!-- Div Vazia --></div>'+
                                                    '<div> Total: '+ValorCompraTotal+'</div>';
                                                    if(ValorLucroTotal>=0)
                                                    {
                                                        //lucro
                                                        texto = texto+
                                                        '<div style="background-color:lightgreen"> Total: '+(ValorLucroTotal).toFixed(2)+'</div>';
                                                    }
                                                    else
                                                    {
                                                        //prejuizo
                                                        texto = texto+
                                                        '<div style="background-color:tomato"> Total : '+(ValorLucroTotal).toFixed(2)+'</div>';
                                                    }
                                                    texto = texto+
                                                '</div>'+
                                            '</div>';
                                        }

                                        //reseta a variavel numero linha
                                        NumeroLinha = 1;

                                        //adiciona uma linha
                                        texto = texto+'<div style="grid-template-rows: 1fr; display: grid"><br></div>';

                                        //reseta as variaveis totais
                                        QuantidadeTotal = 0;
                                        ValorVentaTotal = 0;
                                        ValorCompraTotal = 0;
                                        ValorLucroTotal = 0;
                                    }
                                }
                            }
                            else
                            {
                                //é o ultimo número
                                if($BancoDeDados_Acoes[i].NomeAcao==$BancoDeDados_Acoes[i-1].NomeAcao)
                                {
                                    //São a mesma ação (a ultima com a antipenultima)
                                    //Por ser Day trade não aparece, mas tem que jogar o total final
                                    if(NumeroLinha%2==1)
                                    {
                                        //Linha impar, sem fundo
                                        texto = texto+
                                        '<div style="grid-template-rows: 1fr; display: grid">'+
                                            '<div style="grid-template-columns: repeat(10,1fr); display: grid; text-align: center;">'+
                                                '<div><!-- Div Vazia --></div>'+
                                                '<div>'+$BancoDeDados_Acoes[i].NomeAcao+'</div>'+
                                                '<div>'+$BancoDeDados_Acoes[i].CorretoraAcao+'</div>'+
                                                '<div> Total: '+QuantidadeTotal+'</div>'+
                                                '<div>'+$BancoDeDados_Acoes[i].NotaFiscalAcao+'</div>'+
                                                '<div> Total: '+ValorVentaTotal+'</div>'+
                                                '<div><!-- Div Vazia --></div>'+
                                                '<div><!-- Div Vazia --></div>'+
                                                '<div> Total: '+ValorCompraTotal+'</div>';
                                                if(ValorLucroTotal>=0)
                                                {
                                                    //lucro
                                                    texto = texto+
                                                    '<div style="background-color:lightgreen"> Total: '+(ValorLucroTotal).toFixed(2)+'</div>';
                                                }
                                                else
                                                {
                                                    //prejuizo
                                                    texto = texto+
                                                    '<div style="background-color:tomato"> Total : '+(ValorLucroTotal).toFixed(2)+'</div>';
                                                }
                                                texto = texto+
                                            '</div>'+
                                        '</div>';
                                    }
                                    else
                                    {
                                        //Linha par, com fundo
                                        texto = texto+
                                        '<div style="grid-template-rows: 1fr; display: grid">'+
                                            '<div style="grid-template-columns: repeat(10,1fr); display: grid; text-align: center; background-color:lightgray">'+
                                                '<div><!-- Div Vazia --></div>'+
                                                '<div>'+$BancoDeDados_Acoes[i].NomeAcao+'</div>'+
                                                '<div>'+$BancoDeDados_Acoes[i].CorretoraAcao+'</div>'+
                                                '<div> Total: '+QuantidadeTotal+'</div>'+
                                                '<div>'+$BancoDeDados_Acoes[i].NotaFiscalAcao+'</div>'+
                                                '<div> Total: '+ValorVentaTotal+'</div>'+
                                                '<div><!-- Div Vazia --></div>'+
                                                '<div><!-- Div Vazia --></div>'+
                                                '<div> Total: '+ValorCompraTotal+'</div>';
                                                if(ValorLucroTotal>=0)
                                                {
                                                    //lucro
                                                    texto = texto+
                                                    '<div style="background-color:lightgreen"> Total: '+(ValorLucroTotal).toFixed(2)+'</div>';
                                                }
                                                else
                                                {
                                                    //prejuizo
                                                    texto = texto+
                                                    '<div style="background-color:tomato"> Total : '+(ValorLucroTotal).toFixed(2)+'</div>';
                                                }
                                                texto = texto+
                                            '</div>'+
                                        '</div>';
                                    }

                                    //adiciona uma linha
                                    texto = texto+'<div style="grid-template-rows: 1fr; display: grid"><br></div>';
                                }
                            }
                        }
                    }
                }
                document.getElementById("Controle").innerHTML = texto;
            }








            /** Fonte: <https://www.golangprograms.com/javascript-sort-multi-dimensional-array-on-specific-columns.html>
            * Sorts an array of objects by column/property.
            * @param {Array} array - The array of objects.
            * @param {object} sortObject - The object that contains the sort order keys with directions (asc/desc). e.g. { age: 'desc', name: 'asc' }
            * @returns {Array} The sorted array.
            */
            function multiSort(array, sortObject = {}) 
            {
                const sortKeys = Object.keys(sortObject);

                // Return array if no sort object is supplied.
                if (!sortKeys.length) 
                {
                    return array;
                }

                // Change the values of the sortObject keys to -1, 0, or 1.
                for (let key in sortObject) 
                {
                    sortObject[key] = sortObject[key] === 'desc' || sortObject[key] === -1 ? -1 : (sortObject[key] === 'skip' || sortObject[key] === 0 ? 0 : 1);
                }

                const keySort = (a, b, direction) => 
                { 
                    direction = direction !== null ? direction : 1;

                    if (a === b) 
                    { // If the values are the same, do not switch positions.
                        return 0;
                    }

                    // If b > a, multiply by -1 to get the reverse direction.
                    return a > b ? direction : -1 * direction;
                };

                return array.sort((a, b) => 
                {
                    let sorted = 0;
                    let index = 0;

                    // Loop until sorted (-1 or 1) or until the sort keys have been processed.
                    while (sorted === 0 && index < sortKeys.length) 
                    {
                        const key = sortKeys[index];

                        if (key) 
                        {
                            const direction = sortObject[key];

                            sorted = keySort(a[key], b[key], direction);
                            index++;
                        }
                    }

                    return sorted;
                });
            }

        </script>
    </body>
</html>